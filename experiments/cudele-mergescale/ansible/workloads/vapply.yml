- hosts: clients[0]
  become: True
  tasks:

  #- fail: msg="Uh oh. Please define nfiles"
  #  when: nfiles is not defined
  #- set_fact: output="/popper/results/summary.txt"

  #- name: make a base journal with a bunch of directories
  #  shell: docker exec cephfs  mkdir {{ mount_point }}/mydir{{ item }}
  #  with_sequence: start=0 end=30

  #- name: create the base journal
  #  shell: docker exec cephfs cephfs-journal-tool journal export /etc/ceph/myjournal.bin

  #- name: import the journal
  #  shell: docker exec cephfs cephfs-journal-tool journal import /etc/ceph/myjournal.bin

  - name: add events to the in memory journal and save to a file
    shell: docker exec cephfs cephfs-journal-tool event create summary --nfiles {{ nfiles }} --persist true --file /etc/ceph/events-{{ item }}.bin --decoupled_dir mydir{{ item }}
    with_sequence: start=0 end=30

  - name: move that file to the control server
    fetch: src="/etc/ceph/events-{{ item }}.bin" dest="/tmp/events-{{ item }}.bin" flat=yes
    with_sequence: start=0 end=30

- hosts: mdss[0]
  become: True
  tasks:

  - name: move that file to the metadata server
    copy: dest="/etc/ceph/events-{{ item }}.bin" src="/tmp/events-{{ item }}.bin"
    with_sequence: start=0 end=30
